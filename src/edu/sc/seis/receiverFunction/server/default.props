#
# default sql props for rec func db
#
sodConfig.create=CREATE TABLE sodConfig (config_id int, \
                                         config varchar)
sodConfig.put=INSERT INTO sodConfig (config_id, config) VALUES (?, ?)
sodConfig.get=SELECT config from sodConfig where config_id = ?
sodConfig.getDbId=SELECT config_id from sodConfig where config = ?

sodConfigSeq.create=CREATE SEQUENCE sodConfigSeq
sodConfigSeq.nextVal=SELECT NEXTVAL ('sodConfigSeq')

receiverFunction.create=CREATE TABLE receiverFunction (recFunc_id int, \
                                   origin_id int, \
                                   eventAttr_id int, \
                                   chanA_id int, \
                                   seisA varchar, \
                                   chanB_id int, \
                                   seisB varchar, \
                                   chanZ_id int, \
                                   seisZ varchar, \
                                   recfuncITR varchar, \
                                   itr_match float, \
                                   itr_bump int, \
                                   recFuncITT varchar, \
                                   itt_match float, \
                                   itt_bump int, \
                                   gwidth float, \
                                   maxbumps int, \
                                   tol float, \
                                   insertTime timestamp, \
                                   sodConfig_id int, \
                                   PRIMARY KEY (recFunc_id), \
                                   FOREIGN KEY (origin_id) \
                                   REFERENCES origin (origin_id), \
                                   FOREIGN KEY (eventAttr_id) \
                                   REFERENCES eventattr (eventattr_id), \
                                   FOREIGN KEY (chanA_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanB_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanZ_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (sodConfig_id) \
                                   REFERENCES sodConfig (config_id))
                                   
receiverFunctionSeq.create=CREATE SEQUENCE receiverFunctionSeq
receiverFunctionSeq.nextVal=SELECT NEXTVAL ('receiverFunctionSeq')

hkStack.create=CREATE TABLE hkstack ( \
                   hkstack_id int, \
                   recFunc_id int, \
                   alpha float, \
                   p float, \
                   percentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   data bytea, \
                   insertTime timestamp, \
                   PRIMARY KEY (hkstack_id), \
                   FOREIGN KEY (recFunc_id) \
                   REFERENCES receiverFunction (recFunc_id) )
hkStackSeq.create=CREATE SEQUENCE hkStackSeq
hkStackSeq.nextVal=SELECT NEXTVAL ('hkStackSeq')

hkStack.calcbypercent=SELECT receiverFunction.recfunc_id FROM network \
                   NATURAL JOIN station \
                   NATURAL JOIN site \
                   NATURAL JOIN channel \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ?
                   
hkStack.uncalculated=SELECT receiverFunction.recfunc_id FROM network \
                   NATURAL JOIN station \
                   NATURAL JOIN site \
                   NATURAL JOIN channel \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ? \
                   EXCEPT SELECT receiverFunction.recfunc_id from network \
                       NATURAL JOIN station \
                       NATURAL JOIN site \
                       NATURAL JOIN channel \
                       JOIN receiverFunction ON (chanz_id = chan_id ) \
                       , hkStack \
                       WHERE receiverFunction.recfunc_id = hkstack.recfunc_id

hkStack.put=INSERT INTO hkstack ( \
                   hkstack_id,  \
                   recFunc_id,  \
                   alpha , \
                   p , \
                   percentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   data , \
                   insertTime) \
                   VALUES ( \
                   ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?)
                   
hkStack.getForStation=SELECT * FROM network \
                   NATURAL JOIN station \
                   NATURAL JOIN site \
                   NATURAL JOIN channel \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   ,hkStack \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND percentMatch > ? \
                   AND receiverfunction.recfunc_id = hkstack.recfunc_id

sumhkstack.create=CREATE TABLE sumhkstack ( \
                   sumhkstack_id int, \
                   channel_id int, \
                   alpha float, \
                   p float, \
                   minPercentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   data bytea, \
                   insertTime timestamp, \
                   PRIMARY KEY (sumhkstack_id), \
                   FOREIGN KEY (channel_id) \
                   REFERENCES channel (chan_id) )
                   
sumhkstack.createSeq.create=CREATE SEQUENCE sumhkstackSeq
sumhkstack.createSeq.nextVal=SELECT NEXTVAL ('sumhkstackSeq')

# specifies the database URL
#    for hsqldb
#URL=jdbc:hsqldb:Ears/EarsDb
#    for postgres
URL=jdbc:postgresql:ears
