#
# default sql props for rec func db
#
sodConfig.create=CREATE TABLE sodConfig (config_id int, \
                                         config varchar, \
                                         PRIMARY KEY (config_id))
sodConfig.put=INSERT INTO sodConfig (config_id, config) VALUES (?, ?)
sodConfig.get=SELECT config from sodConfig where config_id = ?
sodConfig.getDbId=SELECT config_id from sodConfig where config = ?

receiverFunction.create=CREATE TABLE receiverFunction (recFunc_id int, \
                                   origin_id int, \
                                   eventAttr_id int, \
                                   chanA_id int, \
                                   seisA varchar, \
                                   chanB_id int, \
                                   seisB varchar, \
                                   chanZ_id int, \
                                   seisZ varchar, \
                                   recfuncITR varchar, \
                                   itr_match float, \
                                   itr_bump int, \
                                   recFuncITT varchar, \
                                   itt_match float, \
                                   itt_bump int, \
                                   gwidth float, \
                                   maxbumps int, \
                                   tol float, \
                                   insertTime timestamp, \
                                   sodConfig_id int, \
                                   PRIMARY KEY (recFunc_id), \
                                   FOREIGN KEY (origin_id) \
                                   REFERENCES origin (origin_id), \
                                   FOREIGN KEY (eventAttr_id) \
                                   REFERENCES eventattr (eventattr_id), \
                                   FOREIGN KEY (chanA_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanB_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanZ_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (sodConfig_id) \
                                   REFERENCES sodConfig (config_id))
                                   
receiverFunction.index_origin=create index receiverfunction_origin_idx on receiverfunction ( origin_id )

receiverFunction.index_chanz=create index receiverfunction_chanz_idx on receiverfunction ( chanz_id )

receiverFunction.getOriginByStation=SELECT * FROM network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
    JOIN  receiverFunction ON (chanz_id = chan_id ) \
    JOIN origin ON (receiverfunction.origin_id = origin.origin_id) \
    JOIN eventattr ON (receiverfunction.eventattr_id = eventattr.eventattr_id) \
    JOIN location ON (origin.origin_location_id = location.loc_id) \
    JOIN catalog ON (origin.origin_catalog_id = catalog.catalog_id) \
    JOIN contributor ON (catalog_contributor_id =   contributor.contributor_id) \
    WHERE network.net_id = ? \
    AND station.sta_code = ?
                   
receiverFunction.countOriginByStationByPercent=SELECT count(*) FROM  \
    station \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
    JOIN  receiverFunction ON (chanz_id = chan_id ) \
    WHERE net_id = ? \
    AND sta_code = ? \
    AND itr_match >= ?
    
receiverFunction.getOriginByStationByPercent=SELECT * FROM netchan \
    JOIN  receiverfunction ON (chanz_id = chan_id ) \
    JOIN origin ON (receiverfunction.origin_id = origin.origin_id) \
    JOIN eventattr ON (receiverfunction.eventattr_id = eventattr.eventattr_id) \
    JOIN location ON (origin.origin_location_id = location.loc_id) \
    JOIN catalog ON (origin.origin_catalog_id = catalog.catalog_id) \
    JOIN contributor ON (catalog_contributor_id =   contributor.contributor_id) \
    WHERE net_id = ? \
    AND sta_code = ? \
    AND itr_match >= ?
    
hkrealimag.create=CREATE TABLE $tablename ( \
	hkrealimag_id int, \
	PsReal bytea, \
	PsImag bytea, \
	PpPsReal bytea, \
	PpPsImag bytea, \
	PsPsReal bytea, \
	PsPsImag bytea, \
	PRIMARY KEY (hkrealimag_id) )
	
hkrealimag.put=INSERT INTO $tablename ( \
	hkrealimag_id, \
	PsReal, \
	PsImag , \
	PpPsReal , \
	PpPsImag , \
	PsPsReal , \
	PsPsImag \
	 ) VALUES ( ?, ?, ?, ?, ?,   ?, ? )
	 
hkrealimag.get=SELECT * FROM $tablename WHERE hkrealimag_id = ?

hkstack.create=CREATE TABLE $tablename ( \
                   hkstack_id int, \
                   recFunc_id int, \
                   alpha float, \
                   p float, \
                   percentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   weightPs float, \
                   weightPpPs float, \
                   weightPsPs float, \
                   hkrealimag_id int, \
                   insertTime timestamp, \
                   PRIMARY KEY (hkstack_id), \
                   FOREIGN KEY (recFunc_id) \
                   REFERENCES receiverFunction (recFunc_id), \
                   FOREIGN KEY (hkrealimag_id) \
                   REFERENCES hkrealimag (hkrealimag_id) )

hkstack.calcbypercent=SELECT receiverFunction.recfunc_id FROM network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ?
                   
hkstack.uncalculated=SELECT receiverFunction.recfunc_id FROM network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ? \
                   EXCEPT SELECT receiverFunction.recfunc_id from network \
                       JOIN station ON (network.net_id = station.net_id ) \
                       JOIN site ON (station.sta_id = site.sta_id ) \
                       JOIN channel ON (channel.site_id = site.site_id ) \
                       JOIN receiverFunction ON (chanz_id = chan_id ) \
                       , hkStack \
                       WHERE receiverFunction.recfunc_id = hkstack.recfunc_id

hkstack.put=INSERT INTO hkstack ( \
                   hkstack_id,  \
                   recFunc_id,  \
                   alpha , \
                   p , \
                   percentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   weightPs , \
                   weightPpPs , \
                   weightPsPs , \
                   hkrealimag_id , \
                   insertTime) \
                   VALUES ( \
                   ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?, ?,?,?)


hkstack.get=SELECT * FROM  \
                   network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   JOIN hkStack ON (hkstack.recfunc_id = receiverFunction.recfunc_id ) \
                   JOIN hkrealimag ON (hkstack.hkrealimag_id = hkrealimag.hkrealimag_id ) \
                   WHERE  \
                   hkstack.recfunc_id = ?

hkstack.getForStation=SELECT * FROM network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   JOIN hkStack ON (hkstack.recfunc_id = receiverFunction.recfunc_id ) \
                   JOIN hkrealimag ON (hkstack.hkrealimag_id = hkrealimag.hkrealimag_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND percentMatch > ?

hkstackToSummary.create=CREATE TABLE $tablename ( \
					hkstack_id int , \
					hksummary_id int , \
					FOREIGN KEY (hkstack_id) REFERENCES hkstack (hkstack_id) , \
					FOREIGN KEY (hksummary_id) REFERENCES hksummary (hksummary_id) )
					
hkstackToSummary.put=INSERT INTO $tablename \
                   ( hkstack_id, hksummary_id ) \
                   VALUES ( ?, ? )

hksummary.create=CREATE TABLE $tablename ( \
                   hksummary_id int, \
                   chanA_id int, \
                   chanB_id int, \
                   chanZ_id int, \
                   alpha float, \
                   minPercentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   weightPs float, \
                   weightPpPs float, \
                   weightPsPs float, \
                   stack bytea, \
                   insertTime timestamp, \
                   hVariance float, \
                   kVariance float, \
                   PRIMARY KEY (hksummary_id), \
                   FOREIGN KEY (chanA_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanB_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanZ_id) \
                   REFERENCES channel (chan_id) \
                   )
	
hksummary.put=INSERT INTO hksummary ( \
                   hksummary_id , \
                   chanA_id , \
                   chanB_id , \
                   chanZ_id , \
                   alpha , \
                   minPercentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   weightPs , \
                   weightPpPs , \
                   weightPsPs , \
                   stack , \
                   insertTime , \
                   hVariance , \
                   kVariance  \
                   ) \
                   VALUES ( ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,  ?, ?)
                   
hksummary.get=SELECT * from $tablename \
                   WHERE hksummary_id = ?
                   
hksummary.update=UPDATE $tablename SET chanA_id = ? , \
                   chanB_id = ? , \
                   chanZ_id = ? , \
                   alpha = ? , \
                   minPercentMatch = ? , \
                   minH = ? , \
                   stepH = ? , \
                   numH = ? , \
                   minK = ? , \
                   stepK = ? , \
                   numK = ? , \
                   peakH = ? , \
                   peakK = ? , \
                   peakVal = ? , \
                   weightPs = ? , \
                   weightPpPs = ? , \
                   weightPsPs = ? , \
                   stack = ? , \
                   insertTime = ? , \
                   hVariance = ? , \
                   kVariance = ? \
                   WHERE hksummary_id = ?
                   
hksummary.uncalculated=SELECT receiverFunction.recfunc_id FROM network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   NATURAL JOIN hkstack \
                   WHERE network.network_dbid = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ? \
                   EXCEPT SELECT receiverFunction.recfunc_id from network \
                       JOIN station ON (network.net_id = station.net_id ) \
                       JOIN site ON (station.sta_id = site.sta_id ) \
                       JOIN channel ON (channel.site_id = site.site_id ) \
                       JOIN receiverFunction ON (chanz_id = chan_id ) \
                       JOIN hkStack ON ( receiverFunction.recfunc_id = hkstack.recfunc_id ) \
                       JOIN hkstackToSummary ON ( hkStack.hkstack_id = hkstackToSummary.hkstack_id ) \
                       JOIN hksummary ON ( hkstackToSummary.hksummary_id = hksummary.hksummary_id ) \
                       WHERE  net_code = ? \
                       AND sta_code = ? \
                       AND receiverFunction.itr_match >= hksummary.minPercentMatch \
                       AND hksummary.minPercentMatch = ? \
                       
hksummary.getForStation=SELECT * from network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  $tablename  ON (chanz_id = chan_id ) \
                   WHERE network.net_id = ? \
                   AND sta_code = ? 

hksummary.index_chanz=create index hksummary_chanz_idx on hksummary ( chanZ_id )
