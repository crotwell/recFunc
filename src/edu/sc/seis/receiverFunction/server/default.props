#
# default sql props for rec func db
#
sodConfig.create=CREATE TABLE sodConfig (config_id int, \
                                         config varchar, \
                                         PRIMARY KEY (config_id))
sodConfig.put=INSERT INTO sodConfig (config_id, config) VALUES (?, ?)
sodConfig.get=SELECT config from sodConfig where config_id = ?
sodConfig.getDbId=SELECT config_id from sodConfig where config = ?

receiverFunction.create=CREATE TABLE receiverFunction (recFunc_id int, \
                                   origin_id int, \
                                   eventAttr_id int, \
                                   chanA_id int, \
                                   seisA varchar, \
                                   chanB_id int, \
                                   seisB varchar, \
                                   chanZ_id int, \
                                   seisZ varchar, \
                                   recfuncITR varchar, \
                                   itr_match float, \
                                   itr_bump int, \
                                   recFuncITT varchar, \
                                   itt_match float, \
                                   itt_bump int, \
                                   gwidth float, \
                                   maxbumps int, \
                                   tol float, \
                                   insertTime timestamp, \
                                   sodConfig_id int, \
                                   PRIMARY KEY (recFunc_id), \
                                   FOREIGN KEY (origin_id) \
                                   REFERENCES origin (origin_id), \
                                   FOREIGN KEY (eventAttr_id) \
                                   REFERENCES eventattr (eventattr_id), \
                                   FOREIGN KEY (chanA_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanB_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (chanZ_id) \
                                   REFERENCES channel (chan_id), \
                                   FOREIGN KEY (sodConfig_id) \
                                   REFERENCES sodConfig (config_id))
                                   
receiverFunction.index_origin=create index receiverfunction_origin_idx on receiverfunction ( origin_id )

receiverFunction.index_chanz=create index receiverfunction_chanz_idx on receiverfunction ( chanz_id )

receiverFunction.getOriginByStation=SELECT * FROM network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
    JOIN  receiverFunction ON (chanz_id = chan_id ) \
    JOIN origin ON (receiverfunction.origin_id = origin.origin_id) \
    JOIN eventattr ON (receiverfunction.eventattr_id = eventattr.eventattr_id) \
    JOIN location ON (origin.origin_location_id = location.loc_id) \
    JOIN catalog ON (origin.origin_catalog_id = catalog.catalog_id) \
    JOIN contributor ON (catalog_contributor_id =   contributor.contributor_id) \
    WHERE network.net_id = ? \
    AND station.sta_code = ? \
    AND gwidth = ?
                   
receiverFunction.countOriginByStationByPercent=SELECT count(*) FROM  \
    station \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
    JOIN  receiverFunction ON (chanz_id = chan_id ) \
    WHERE net_id = ? \
    AND sta_code = ? \
    AND gwidth = ? \
    AND itr_match >= ?
    
receiverFunction.getOriginByStationByPercent=SELECT * FROM netchan \
    JOIN  receiverfunction ON (chanz_id = chan_id ) \
    JOIN origin ON (receiverfunction.origin_id = origin.origin_id) \
    JOIN eventattr ON (receiverfunction.eventattr_id = eventattr.eventattr_id) \
    JOIN location ON (origin.origin_location_id = location.loc_id) \
    JOIN catalog ON (origin.origin_catalog_id = catalog.catalog_id) \
    JOIN contributor ON (catalog_contributor_id =   contributor.contributor_id) \
    WHERE net_id = ? \
    AND sta_code = ? \
    AND gwidth = ? \
    AND itr_match >= ?
    
hkrealimag.create=CREATE TABLE $tablename ( \
	hkrealimag_id int, \
	PsReal bytea, \
	PsImag bytea, \
	PpPsReal bytea, \
	PpPsImag bytea, \
	PsPsReal bytea, \
	PsPsImag bytea, \
	PRIMARY KEY (hkrealimag_id) )
	
hkrealimag.put=INSERT INTO $tablename ( \
	hkrealimag_id, \
	PsReal, \
	PsImag , \
	PpPsReal , \
	PpPsImag , \
	PsPsReal , \
	PsPsImag \
	 ) VALUES ( ?, ?, ?, ?, ?,   ?, ? )
	 
hkrealimag.get=SELECT * FROM $tablename WHERE hkrealimag_id = ?

hkstack.create=CREATE TABLE $tablename ( \
                   hkstack_id int, \
                   recFunc_id int, \
                   alpha float, \
                   p float, \
                   percentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   weightPs float, \
                   weightPpPs float, \
                   weightPsPs float, \
                   hkrealimag_id int, \
                   insertTime timestamp, \
                   PRIMARY KEY (hkstack_id), \
                   FOREIGN KEY (recFunc_id) \
                   REFERENCES receiverFunction (recFunc_id), \
                   FOREIGN KEY (hkrealimag_id) \
                   REFERENCES hkrealimag (hkrealimag_id) )

hkstack.calcbypercent=SELECT receiverFunction.recfunc_id FROM network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ?
                   
hkstack.uncalculated=SELECT receiverFunction.recfunc_id FROM network \
    JOIN station ON (network.net_id = station.net_id ) \
    JOIN site ON (station.sta_id = site.sta_id ) \
    JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ? \
                   EXCEPT SELECT receiverFunction.recfunc_id from network \
                       JOIN station ON (network.net_id = station.net_id ) \
                       JOIN site ON (station.sta_id = site.sta_id ) \
                       JOIN channel ON (channel.site_id = site.site_id ) \
                       JOIN receiverFunction ON (chanz_id = chan_id ) \
                       , hkStack \
                       WHERE receiverFunction.recfunc_id = hkstack.recfunc_id

hkstack.put=INSERT INTO hkstack ( \
                   hkstack_id,  \
                   recFunc_id,  \
                   alpha , \
                   p , \
                   percentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   weightPs , \
                   weightPpPs , \
                   weightPsPs , \
                   hkrealimag_id , \
                   insertTime) \
                   VALUES ( \
                   ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?,  ?, ?, ?, ?, ?,?,?)


hkstack.get=SELECT * FROM  \
                   network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   JOIN hkStack ON (hkstack.recfunc_id = receiverFunction.recfunc_id ) \
                   JOIN hkrealimag ON (hkstack.hkrealimag_id = hkrealimag.hkrealimag_id ) \
                   WHERE  \
                   hkstack.recfunc_id = ?

hkstack.getForStation=SELECT * FROM network \
                   JOIN station ON (network.net_id = station.net_id ) \
                   JOIN site ON (station.sta_id = site.sta_id ) \
                   JOIN channel ON (channel.site_id = site.site_id ) \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   JOIN hkStack ON (hkstack.recfunc_id = receiverFunction.recfunc_id ) \
                   JOIN hkrealimag ON (hkstack.hkrealimag_id = hkrealimag.hkrealimag_id ) \
                   WHERE net_code = ? \
                   AND sta_code = ? \
                   AND gwidth = ? \
                   AND percentMatch > ?

hkstackToSummary.create=CREATE TABLE $tablename ( \
					hkstack_id int , \
					hksummary_id int , \
					FOREIGN KEY (hkstack_id) REFERENCES hkstack (hkstack_id) , \
					FOREIGN KEY (hksummary_id) REFERENCES hksummary (hksummary_id) )
					
hkstackToSummary.put=INSERT INTO $tablename \
                   ( hkstack_id, hksummary_id ) \
                   VALUES ( ?, ? )

hksummary.create=CREATE TABLE $tablename ( \
                   hksummary_id int, \
                   chanA_id int, \
                   chanB_id int, \
                   chanZ_id int, \
                   alpha float, \
                   gwidth float, \
                   minPercentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   weightPs float, \
                   weightPpPs float, \
                   weightPsPs float, \
                   stack bytea, \
                   insertTime timestamp, \
                   hVariance float, \
                   kVariance float, \
                   numeq int, \
                   PRIMARY KEY (hksummary_id), \
                   FOREIGN KEY (chanA_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanB_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanZ_id) \
                   REFERENCES channel (chan_id) \
                   )
	
hksummary.put=INSERT INTO $tablename ( \
                   hksummary_id , \
                   chanA_id , \
                   chanB_id , \
                   chanZ_id , \
                   alpha , \
                   gwidth, \
                   minPercentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   weightPs , \
                   weightPpPs , \
                   weightPsPs , \
                   stack , \
                   insertTime , \
                   hVariance , \
                   kVariance,  \
                   numeq \
                   ) \
                   VALUES ( ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,  ?, ?, ?, ?)
                   
hksummary.get=SELECT * from $tablename JOIN netchan ON (chanz_id = chan_id ) \
                   JOIN stackComplexity ON (${tablename}.hksummary_id = stackComplexity.hksummary_id) \
                   WHERE ${tablename}.hksummary_id = ?
                   
hksummary.update=UPDATE $tablename SET chanA_id = ? , \
                   chanB_id = ? , \
                   chanZ_id = ? , \
                   alpha = ? , \
                   gwidth = ?, \
                   minPercentMatch = ? , \
                   minH = ? , \
                   stepH = ? , \
                   numH = ? , \
                   minK = ? , \
                   stepK = ? , \
                   numK = ? , \
                   peakH = ? , \
                   peakK = ? , \
                   peakVal = ? , \
                   weightPs = ? , \
                   weightPpPs = ? , \
                   weightPsPs = ? , \
                   stack = ? , \
                   insertTime = ? , \
                   hVariance = ? , \
                   kVariance = ?, \
                   numeq = ? \
                   WHERE hksummary_id = ?
                   
hksummary.uncalculated=SELECT receiverFunction.recfunc_id FROM netchan \
                   JOIN  receiverFunction ON (chanz_id = chan_id ) \
                   NATURAL JOIN hkstack \
                   WHERE network.network_dbid = ? \
                   AND sta_code = ? \
                   AND receiverFunction.itr_match >= ? \
                   AND gwidth = ? \
                   EXCEPT SELECT receiverFunction.recfunc_id from network \
                       JOIN station ON (network.net_id = station.net_id ) \
                       JOIN site ON (station.sta_id = site.sta_id ) \
                       JOIN channel ON (channel.site_id = site.site_id ) \
                       JOIN receiverFunction ON (chanz_id = chan_id ) \
                       JOIN hkStack ON ( receiverFunction.recfunc_id = hkstack.recfunc_id ) \
                       JOIN hkstackToSummary ON ( hkStack.hkstack_id = hkstackToSummary.hkstack_id ) \
                       JOIN hksummary ON ( hkstackToSummary.hksummary_id = hksummary.hksummary_id ) \
                       WHERE  net_code = ? \
                       AND sta_code = ? \
                       AND gwidth = ? \
                       AND receiverFunction.itr_match >= hksummary.minPercentMatch \
                       AND hksummary.minPercentMatch = ? \
                       
hksummary.getForStation=SELECT * from netchan \
                   JOIN  $tablename  ON (chanz_id = chan_id ) \
                   JOIN stackComplexity ON (${tablename}.hksummary_id = stackComplexity.hksummary_id) \
                   WHERE network.net_id = ? \
                   AND sta_code = ? \
                   AND gwidth = ? \
                   AND minPercentMatch = ?

hksummary.getAllWithoutData=SELECT ${tablename}.hksummary_id AS hksummary_id, alpha, minpercentmatch, peakh, hvariance, peakk, kvariance, peakval, net_code, sta_code, chanz_id, \
	minH, stepH, numH, minK, stepK, numK, weightPs, weightPpPs, weightPsPs, numeq, gwidth, complexity, complexity25, complexity50,bestH , \
                   bestHStdDev , \
                   bestK , \
                   bestKStdDev , \
                   bestVal , \
                   hkCorrelation, \
                   nextH , \
                   nextK , \
                   nextVal , \
                   crust2diff  \
	FROM $tablename \
	JOIN netchan ON (chanz_id = chan_id) \
     JOIN stackComplexity ON (${tablename}.hksummary_id = stackComplexity.hksummary_id) \

hksummary.getAll=SELECT *  \
	FROM $tablename JOIN netchan ON (chanz_id = chan_id) \
     JOIN stackComplexity ON (${tablename}.hksummary_id = stackComplexity.hksummary_id) \

hksummary.index_chanz=create index hksummary_chanz_idx on $tablename ( chanz_id )

azimuthhksummary.create=CREATE TABLE $tablename ( \
                   azimuthhksummary_id int, \
                   chanA_id int, \
                   chanB_id int, \
                   chanZ_id int, \
                   alpha float, \
                   minPercentMatch float, \
                   minH float, \
                   stepH float, \
                   numH int, \
                   minK float, \
                   stepK float, \
                   numK int, \
                   peakH float, \
                   peakK float, \
                   peakVal float, \
                   weightPs float, \
                   weightPpPs float, \
                   weightPsPs float, \
                   stack bytea, \
                   insertTime timestamp, \
                   hVariance float, \
                   kVariance float, \
                   numeq int, \
                   azimuth float, \
                   azwidth float, \
                   PRIMARY KEY (azimuthhksummary_id), \
                   FOREIGN KEY (chanA_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanB_id) \
                   REFERENCES channel (chan_id), \
                   FOREIGN KEY (chanZ_id) \
                   REFERENCES channel (chan_id) \
                   )
	
azimuthhksummary.put=INSERT INTO $tablename ( \
                   azimuthhksummary_id , \
                   chanA_id , \
                   chanB_id , \
                   chanZ_id , \
                   alpha , \
                   minPercentMatch , \
                   minH , \
                   stepH , \
                   numH , \
                   minK , \
                   stepK , \
                   numK , \
                   peakH , \
                   peakK , \
                   peakVal , \
                   weightPs , \
                   weightPpPs , \
                   weightPsPs , \
                   stack , \
                   insertTime , \
                   hVariance , \
                   kVariance, \
                   numeq, \
                   azimuth, \
                   azwidth  \
                   ) \
                   VALUES ( ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,   ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?)
                   
azimuthhksummary.get=SELECT * from $tablename JOIN netchan ON (chanz_id = chan_id ) \
                   WHERE azimuthhksummary_id = ?
                   
azimuthhksummary.update=UPDATE $tablename SET chanA_id = ? , \
                   chanB_id = ? , \
                   chanZ_id = ? , \
                   alpha = ? , \
                   minPercentMatch = ? , \
                   minH = ? , \
                   stepH = ? , \
                   numH = ? , \
                   minK = ? , \
                   stepK = ? , \
                   numK = ? , \
                   peakH = ? , \
                   peakK = ? , \
                   peakVal = ? , \
                   weightPs = ? , \
                   weightPpPs = ? , \
                   weightPsPs = ? , \
                   stack = ? , \
                   insertTime = ? , \
                   hVariance = ? , \
                   kVariance = ? , \
                   numeq = ? , \
                   azimuth = ? , \
                   azwidth = ?  \
                   WHERE azimuthhksummary_id = ?
                       
azimuthhksummary.getForStation=SELECT * from netchan \
                   JOIN  $tablename  ON (chanz_id = chan_id ) \
                   WHERE network.net_id = ? \
                   AND sta_code = ? \
                   AND azimuth = ? \
                   AND azwidth = ?

azimuthhksummary.getAllWithoutData=SELECT alpha, minpercentmatch, peakh, hvariance, peakk, kvariance, peakval, net_code, sta_code, chanz_id, \
	minH, stepH, numH, minK, stepK, numK, weightPs, weightPpPs, weightPsPs, numeq, azimuth, azwidth  \
	FROM $tablename JOIN netchan ON (chanz_id = chan_id)

azimuthhksummary.index_chanz=create index azimuthhksummary_chanz_idx on $tablename ( chanz_id )


stackComplexity.create=CREATE TABLE $tablename ( \
                   hksummary_id int, \
                   complexity float, \
                   complexity25 float, \
                   complexity50 float, \
                   bestH float, \
                   bestHStdDev float, \
                   bestK float, \
                   bestKStdDev float, \
                   bestVal float, \
                   hkCorrelation float, \
                   nextH float, \
                   nextK float, \
                   nextVal float, \
                   crust2diff float, \
                   FOREIGN KEY (hksummary_id) \
                   REFERENCES hksummary (hksummary_id) \
                   )

stackComplexity.get=SELECT * from $tablename WHERE hksummary_id = ?

stackComplexity.put=INSERT INTO $tablename ( \
				hksummary_id, \
				complexity, \
				complexity25, \
				complexity50, \
                   bestH , \
                   bestHStdDev , \
                   bestK , \
                   bestKStdDev , \
                   bestVal , \
                   hkCorrelation, \
                   nextH , \
                   nextK , \
                   nextVal , \
                   crust2diff \
				) VALUES ( ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ? )
				
stackComplexity.update=UPDATE $tablename \
				SET complexity = ?, \
				complexity25 = ?, \
				complexity50 = ?, \
                   bestH = ?, \
                   bestHStdDev = ?, \
                   bestK = ?, \
                   bestKStdDev = ?, \
                   bestVal = ?, \
                   hkCorrelation = ?, \
                   nextH = ?, \
                   nextK = ?, \
                   nextVal = ?, \
                   crust2diff = ? \
				WHERE hksummary_id = ? 
				
amplitude.create=CREATE TABLE $tablename ( \
    hkstack_id int, \
    recFunc_id int, \
    ampP float, \
    ampPs float, \
    ampPpPs float, \
    ampPsPs float, \
    insertTime timestamp, \
    PRIMARY KEY (hkstack_id), \
    FOREIGN KEY (recFunc_id) \
    REFERENCES receiverFunction (recFunc_id) \
	)
	
amplitude.put=INSERT INTO $tablename ( \
    hkstack_id, \
    recFunc_id, \
    ampP, \
    ampPs, \
    ampPpPs, \
    ampPsPs, \
    insertTime \
    ) VALUES ( ?, ?, ?, ?, ?,  ?, ? )

amplitude.getForStation=SELECT net_code, sta_code, ampP, ampPs, ampPpPs, ampPsPs, insertTime from $tablename \
    JOIN receiverFunction ON ( ${tablename}.recFunc_id = receiverFunction.recFunc_id ) \
    JOIN netchan ON ( receiverFunction.chanz_id = netchan.chanz_id ) \
    WHERE net_code = ? AND sta_code = ?
 
 